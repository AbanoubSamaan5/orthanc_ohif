"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4526],{58295:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var a=n(86326),s=n(99993),i=n(19683),r=n(11078);const o=function(e,t,n){const a=t.getCustomization("cornerstone.overlayViewportTools");return e.createToolGroupAndAddTools(n,a)},l={NO_NEVER:-1,CANCEL:0,HYDRATE_SEG:5};const c=function({servicesManager:e,segDisplaySet:t,viewportId:n,preHydrateCallbacks:a,hydrateCallback:s}){const{uiViewportDialogService:r}=e.services,o=e._extensionManager._appConfig;return new Promise((async function(e,c){const d=o?.disableConfirmationPrompts?l.HYDRATE_SEG:await function(e,t){return new Promise((function(n,a){const s="Do you want to open this Segmentation?",r=[{id:"no-hydrate",type:i.Ny.NW.secondary,text:"No",value:l.CANCEL},{id:"yes-hydrate",type:i.Ny.NW.primary,text:"Yes",value:l.HYDRATE_SEG}],o=t=>{e.hide(),n(t)};e.show({viewportId:t,type:"info",message:s,actions:r,onSubmit:o,onOutsideClick:()=>{e.hide(),n(l.CANCEL)},onKeyPress:e=>{"Enter"===e.key&&o(l.HYDRATE_SEG)}})}))}(r,n);d===l.HYDRATE_SEG&&(a?.forEach((e=>{e()})),window.setTimeout((async()=>{const a=await s({segDisplaySet:t,viewportId:n});e(a)}),0))}))};function d({isHydrated:e,onStatusClick:t}){let n=null,o=null;switch(e){case!0:o=()=>a.createElement(r.FI.ByName,{name:"status-alert"}),n=()=>a.createElement("div",null,"This Segmentation is loaded in the segmentation panel");break;case!1:o=()=>a.createElement(r.FI.ByName,{className:"text-aqua-pale",name:"status-untracked"}),n=()=>a.createElement("div",null,"Click LOAD to load segmentation.")}const l=()=>{const{t:n}=(0,s.Bd)("Common"),r=n("LOAD");return a.createElement("div",{className:"flex h-6 cursor-default text-sm leading-6 text-white"},a.createElement("div",{className:"bg-customgray-100 flex min-w-[45px] items-center rounded-l-xl rounded-r p-1"},a.createElement(o,null),a.createElement("span",{className:"ml-1"},"SEG")),!e&&a.createElement(i.N8,{onInteraction:t},r))};return a.createElement(a.Fragment,null,n&&a.createElement(r.m_,null,a.createElement(r.k$,{asChild:!0},a.createElement("span",null,a.createElement(l,null))),a.createElement(r.ZI,{side:"bottom"},a.createElement(n,null))),!n&&a.createElement(l,null))}var u=n(20895),p=n(99737);function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},m.apply(null,arguments)}const S=function(e){const{children:t,displaySets:n,viewportOptions:l,servicesManager:S,extensionManager:E,commandsManager:y}=e,{t:I}=(0,s.Bd)("SEGViewport"),g=l.viewportId,{displaySetService:v,toolGroupService:w,segmentationService:f,customizationService:C,viewportActionCornersService:D}=S.services,b=C.getCustomization("ui.loadingIndicatorTotalPercent"),h=`SEGToolGroup-${g}`;if(n.length>1)throw new Error("SEG viewport should only have a single display set");const N=n[0],[T,P]=(0,r.ih)(),{setPositionPresentation:A}=(0,u.usePositionPresentationStore)(),[k,x]=(0,a.useState)(N.isHydrated),[G,O]=(0,a.useState)(!N.isLoaded),[M,L]=(0,a.useState)(null),[R,U]=(0,a.useState)({percentComplete:null,totalSegments:null}),_=(0,a.useRef)(null),{viewports:V,activeViewportId:H}=T,B=N.referencedDisplaySetInstanceUID,F=v.getDisplaySetByUID(B),Y=function(e,t){const{SharedFunctionalGroupsSequence:n}=t.instance,a=Array.isArray(n)?n[0]:n,{PixelMeasuresSequence:s}=a,i=Array.isArray(s)?s[0]:s,{SpacingBetweenSlices:r,SliceThickness:o}=i,l=e.images[0],c={PatientID:l.PatientID,PatientName:l.PatientName,PatientSex:l.PatientSex,PatientAge:l.PatientAge,SliceThickness:l.SliceThickness||o,StudyDate:l.StudyDate,SeriesDescription:l.SeriesDescription,SeriesInstanceUID:l.SeriesInstanceUID,SeriesNumber:l.SeriesNumber,ManufacturerModelName:l.ManufacturerModelName,SpacingBetweenSlices:l.SpacingBetweenSlices||r};return c}(F,N);_.current={displaySet:F,metadata:Y};const j=()=>{L(null)},q=(0,a.useCallback)((()=>{T?.viewports.forEach((({viewportId:e})=>{y.runCommand("storePresentation",{viewportId:e})}))}),[T]),z=(0,a.useCallback)((()=>{const{component:t}=E.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone");return a.createElement(t,m({},e,{displaySets:[N],viewportOptions:{viewportType:l.viewportType,toolGroupId:h,orientation:l.orientation,viewportId:l.viewportId,presentationIds:l.presentationIds},onElementEnabled:t=>{e.onElementEnabled?.(t),(e=>{L(e.detail.element)})(t)},onElementDisabled:j}))}),[g,N,h]),$=(0,a.useCallback)((e=>{u.utils.handleSegmentChange({direction:e,segDisplaySet:N,viewportId:g,selectedSegmentObjectIndex:0,segmentationService:f})}),[0]),W=(0,a.useCallback)((()=>{y.runCommand("updateStoredSegmentationPresentation",{displaySet:N,type:p.SegmentationRepresentations.Labelmap}),y.runCommand("updateStoredPositionPresentation",{viewportId:g,displaySetInstanceUID:F.displaySetInstanceUID}),P.setDisplaySetsForViewport({viewportId:g,displaySetInstanceUIDs:[F.displaySetInstanceUID]})}),[y,g,F,N]);(0,a.useEffect)((()=>{G||c({servicesManager:S,viewportId:g,segDisplaySet:N,preHydrateCallbacks:[q],hydrateCallback:W}).then((e=>{e&&x(!0)}))}),[S,g,N,G,W]),(0,a.useEffect)((()=>{f.clearSegmentationRepresentations(g);const{unsubscribe:e}=f.subscribe(f.EVENTS.SEGMENTATION_LOADING_COMPLETE,(e=>{if(e.segDisplaySet.displaySetInstanceUID===N.displaySetInstanceUID&&O(!1),N?.firstSegmentedSliceImageId&&l?.presentationIds){const{firstSegmentedSliceImageId:e}=N,{presentationIds:t}=l;A(t.positionPresentationId,{viewReference:{referencedImageId:e}})}}));return()=>{e()}}),[N]),(0,a.useEffect)((()=>{const{unsubscribe:e}=f.subscribe(f.EVENTS.SEGMENT_LOADING_COMPLETE,(({percentComplete:e,numSegments:t})=>{U({percentComplete:e,totalSegments:t})}));return()=>{e()}}),[N]),(0,a.useEffect)((()=>{const e=v.subscribe(v.EVENTS.DISPLAY_SETS_REMOVED,(({displaySetInstanceUIDs:e})=>{const t=V.get(H);e.includes(t.displaySetInstanceUID)&&P.setDisplaySetsForViewport({viewportId:H,displaySetInstanceUIDs:[]})}));return()=>{e.unsubscribe()}}),[]),(0,a.useEffect)((()=>{let e=w.getToolGroup(h);if(!e)return y.runCommand("updateStoredSegmentationPresentation",{displaySet:N,type:p.SegmentationRepresentations.Labelmap}),f.clearSegmentationRepresentations(g),e=o(w,C,h),()=>{f.clearSegmentationRepresentations(g),w.destroyToolGroup(h)}}),[]);const K=(0,a.useCallback)((async()=>{q(),W()}),[q,W]);(0,a.useEffect)((()=>{D.addComponents([{viewportId:g,id:"viewportStatusComponent",component:d({isHydrated:k,onStatusClick:K}),indexPriority:-100,location:D.LOCATIONS.topLeft},{viewportId:g,id:"viewportActionArrowsComponent",component:a.createElement(i.$I,{key:"actionArrows",onArrowsClick:$,className:g===H?"visible":"invisible group-hover/pane:visible"}),indexPriority:0,location:D.LOCATIONS.topRight}])}),[H,k,$,K,D,g]);let Z=null;return _.current&&F.displaySetInstanceUID===_.current.displaySet.displaySetInstanceUID?(t&&t.length&&(Z=t.map(((e,t)=>e&&a.cloneElement(e,{viewportId:g,key:t})))),a.createElement(a.Fragment,null,a.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},G&&a.createElement(b,{className:"h-full w-full",totalNumbers:R.totalSegments,percentComplete:R.percentComplete,loadingText:"Loading SEG..."}),z(),Z))):null}}}]);
//# sourceMappingURL=4526.bundle.6160bc610007929acec7.js.map