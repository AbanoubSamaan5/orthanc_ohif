"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9890,8402],{23121:(e,t,n)=>{n.r(t),n.d(t,{default:()=>E});var r=n(86326),a=n(97598),i=n.n(a),s=n(19683),o=n(11078),l=n(20895);const c={NO_NEVER:-1,CANCEL:0,HYDRATE_SEG:5};const p=function({servicesManager:e,rtDisplaySet:t,viewportId:n,preHydrateCallbacks:r,hydrateRTDisplaySet:a}){const{uiViewportDialogService:i}=e.services,o=e._extensionManager._appConfig;return new Promise((async function(l,p){const d=o?.disableConfirmationPrompts?c.HYDRATE_SEG:await function(e,t){return new Promise((function(n,r){const a="Do you want to open this Segmentation?",i=[{id:"no-hydrate",type:s.Ny.NW.secondary,text:"No",value:c.CANCEL},{id:"yes-hydrate",type:s.Ny.NW.primary,text:"Yes",value:c.HYDRATE_SEG}],o=t=>{e.hide(),n(t)};e.show({id:"promptHydrateRT",viewportId:t,type:"info",message:a,actions:i,onSubmit:o,onOutsideClick:()=>{e.hide(),n(c.CANCEL)},onKeyPress:e=>{"Enter"===e.key&&o(c.HYDRATE_SEG)}})}))}(i,n);if(d===c.HYDRATE_SEG){r?.forEach((e=>{e()}));l(await a({rtDisplaySet:t,viewportId:n,servicesManager:e}))}}))};var d=n(99993);function u({isHydrated:e,onStatusClick:t}){let n=null,a=null;switch(e){case!0:a=()=>r.createElement(o.FI.ByName,{name:"status-alert"}),n=()=>r.createElement("div",null,"This Segmentation is loaded in the segmentation panel");break;case!1:a=()=>r.createElement(o.FI.ByName,{className:"text-aqua-pale",name:"status-untracked"}),n=()=>r.createElement("div",null,"Click LOAD to load RTSTRUCT.")}const i=()=>{const{t:n}=(0,d.Bd)("Common"),i=n("LOAD");return r.createElement("div",{className:"flex h-6 cursor-default text-sm leading-6 text-white"},r.createElement("div",{className:"bg-customgray-100 flex min-w-[45px] items-center rounded-l-xl rounded-r p-1"},r.createElement(a,null),r.createElement("span",{className:"ml-1"},"RTSTRUCT")),!e&&r.createElement(s.N8,{onInteraction:t},i))};return r.createElement(r.Fragment,null,n&&r.createElement(o.m_,null,r.createElement(o.k$,{asChild:!0},r.createElement("span",null,r.createElement(i,null))),r.createElement(o.ZI,{side:"bottom"},r.createElement(n,null))),!n&&r.createElement(i,null))}const m=function(e,t,n){const r=t.getCustomization("cornerstone.overlayViewportTools");return e.createToolGroupAndAddTools(n,r)};function S(){return S=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},S.apply(null,arguments)}function y(e){const{children:t,displaySets:n,viewportOptions:a,servicesManager:i,extensionManager:c,commandsManager:d}=e,{displaySetService:y,toolGroupService:E,segmentationService:v,uiNotificationService:I,customizationService:g,viewportActionCornersService:w}=i.services,f=a.viewportId,C=`RTToolGroup-${f}`;if(n.length>1)throw new Error("RT viewport should only have a single display set");const T=g.getCustomization("ui.loadingIndicatorTotalPercent"),h=n[0],[D,b]=(0,o.ih)(),{setPositionPresentation:N}=(0,l.usePositionPresentationStore)(),[k,P]=(0,r.useState)(h.isHydrated),[A,R]=(0,r.useState)(!h.isLoaded),[O,x]=(0,r.useState)(null),[M,G]=(0,r.useState)({percentComplete:null,totalSegments:null}),L=(0,r.useRef)(null),{viewports:_,activeViewportId:U}=D,H=h.referencedDisplaySetInstanceUID,V=y.getDisplaySetByUID(H),Y=function(e){const t=e.images[0],n={PatientID:t.PatientID,PatientName:t.PatientName,PatientSex:t.PatientSex,PatientAge:t.PatientAge,SliceThickness:t.SliceThickness,StudyDate:t.StudyDate,SeriesDescription:t.SeriesDescription,SeriesInstanceUID:t.SeriesInstanceUID,SeriesNumber:t.SeriesNumber,ManufacturerModelName:t.ManufacturerModelName,SpacingBetweenSlices:t.SpacingBetweenSlices};return n}(V);L.current={displaySet:V,metadata:Y};const B=()=>{x(null)},j=(0,r.useCallback)((()=>{D?.viewports.forEach((({viewportId:e})=>{d.runCommand("storePresentation",{viewportId:e})}))}),[D]),F=(0,r.useCallback)((({rtDisplaySet:e,viewportId:t})=>{d.runCommand("hydrateRTSDisplaySet",{displaySet:e,viewportId:t})}),[d]),z=(0,r.useCallback)((()=>{const{component:t}=c.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone"),{displaySet:n}=L.current;return r.createElement(t,S({},e,{displaySets:[n,h],viewportOptions:{viewportType:"stack",toolGroupId:C,orientation:a.orientation,viewportId:a.viewportId,presentationIds:a.presentationIds},onElementEnabled:t=>{e.onElementEnabled?.(t),(e=>{x(e.detail.element)})(t)},onElementDisabled:B}))}),[f,h,C]),$=(0,r.useCallback)((e=>{l.utils.handleSegmentChange({direction:e,segDisplaySet:h,viewportId:f,selectedSegmentObjectIndex:0,segmentationService:v})}),[0]);(0,r.useEffect)((()=>{A||p({servicesManager:i,viewportId:f,rtDisplaySet:h,preHydrateCallbacks:[j],hydrateRTDisplaySet:F}).then((e=>{e&&P(!0)}))}),[i,f,h,A]),(0,r.useEffect)((()=>{const{unsubscribe:e}=v.subscribe(v.EVENTS.SEGMENTATION_LOADING_COMPLETE,(e=>{if(e.rtDisplaySet.displaySetInstanceUID===h.displaySetInstanceUID&&R(!1),h?.firstSegmentedSliceImageId&&a?.presentationIds){const{firstSegmentedSliceImageId:e}=h,{presentationIds:t}=a;N(t.positionPresentationId,{viewportType:"stack",viewReference:{referencedImageId:e},viewPresentation:{}})}e.overlappingSegments&&I.show({title:"Overlapping Segments",message:"Overlapping segments detected which is not currently supported",type:"warning"})}));return()=>{e()}}),[h]),(0,r.useEffect)((()=>{const{unsubscribe:e}=v.subscribe(v.EVENTS.SEGMENT_LOADING_COMPLETE,(({percentComplete:e,numSegments:t})=>{G({percentComplete:e,totalSegments:t})}));return()=>{e()}}),[h]),(0,r.useEffect)((()=>{const e=y.subscribe(y.EVENTS.DISPLAY_SETS_REMOVED,(({displaySetInstanceUIDs:e})=>{const t=_.get(U);e.includes(t.displaySetInstanceUID)&&b.setDisplaySetsForViewport({viewportId:U,displaySetInstanceUIDs:[]})}));return()=>{e.unsubscribe()}}),[]),(0,r.useEffect)((()=>{let e=E.getToolGroup(C);if(!e)return e=m(E,g,C),()=>{v.removeSegmentationRepresentations(f),E.destroyToolGroup(C)}}),[]),(0,r.useEffect)((()=>(P(h.isHydrated),()=>{v.removeSegmentationRepresentations(f),L.current=null})),[h]);const q=(0,r.useCallback)((async()=>{j();const e=await F({rtDisplaySet:h,viewportId:f});P(e)}),[F,h,j,f]);let W=null;return L.current&&V.displaySetInstanceUID===L.current.displaySet.displaySetInstanceUID?(t&&t.length&&(W=t.map(((e,t)=>e&&r.cloneElement(e,{viewportId:f,key:t})))),(0,r.useEffect)((()=>{w.addComponents([{viewportId:f,id:"viewportStatusComponent",component:u({isHydrated:k,onStatusClick:q}),indexPriority:-100,location:w.LOCATIONS.topLeft},{viewportId:f,id:"viewportActionArrowsComponent",component:r.createElement(s.$I,{key:"actionArrows",onArrowsClick:$,className:f===U?"visible":"invisible group-hover/pane:visible"}),indexPriority:0,location:w.LOCATIONS.topRight}])}),[U,k,$,q,w,f]),r.createElement(r.Fragment,null,r.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},A&&r.createElement(T,{className:"h-full w-full",totalNumbers:M.totalSegments,percentComplete:M.percentComplete,loadingText:"Loading RTSTRUCT..."}),z(),W))):null}y.propTypes={displaySets:i().arrayOf(i().object),viewportId:i().string.isRequired,dataSource:i().object,children:i().node};const E=y}}]);
//# sourceMappingURL=9890.bundle.f8f5289e379055703f74.js.map