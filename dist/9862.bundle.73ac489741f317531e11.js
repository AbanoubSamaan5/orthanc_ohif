"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9862],{49862:(e,t,n)=>{n.r(t),n.d(t,{default:()=>f});var r=n(86326),s=n(97598),i=n.n(s),o=n(19683),a=n(11078),l=n(4667),c=n(79044),u=n(15327),d=n(99993);function E(){return E=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},E.apply(null,arguments)}function m(e){const{displaySets:t,viewportId:n,servicesManager:s,extensionManager:i}=e,{measurementService:o,cornerstoneViewportService:m,viewportGridService:f,viewportActionCornersService:v}=s.services,S=t[0],{t:I}=(0,d.Bd)("Common"),[w]=(0,a.ih)(),{activeViewportId:g}=w,[b,h]=(0,c.B)(),[D,V]=(0,r.useState)(!1),[T,y]=(0,r.useState)(null),[C,R]=(0,r.useState)(null),{trackedSeries:k}=b.context,{SeriesInstanceUID:A}=S,M=(0,r.useCallback)((()=>{const e=m.getCornerstoneViewport(n);if(e instanceof u.BaseVolumeViewport){const t=e?.getCurrentImageId();if(!t)return void(D&&V(!1))}k.includes(A)!==D&&V(!D)}),[D,b,n,A]),N=(0,r.useCallback)((e=>{e.detail.element!==C&&(e.detail.element?.addEventListener(u.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,M),R(e.detail.element))}),[M,C]),O=(0,r.useCallback)((()=>{C?.removeEventListener(u.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,M)}),[M,C]);(0,r.useEffect)(M,[M]),(0,r.useEffect)((()=>{const{unsubscribe:e}=m.subscribe(m.EVENTS.VIEWPORT_DATA_CHANGED,(e=>{e.viewportId===n&&M()}));return()=>{e()}}),[M,n]),(0,r.useEffect)((()=>D?(l.annotation.config.style.setViewportToolStyles(n,{ReferenceLines:{lineDash:"4,4"},global:{lineDash:""}}),void m.getRenderingEngine().renderViewport(n)):(l.annotation.config.style.setViewportToolStyles(n,{global:{lineDash:"4,4"}}),m.getRenderingEngine().renderViewport(n),()=>{l.annotation.config.style.setViewportToolStyles(n,{})})),[D]),(0,r.useEffect)((()=>{const e=o.EVENTS.MEASUREMENT_ADDED,t=o.EVENTS.RAW_MEASUREMENT_ADDED,r=[];return[e,t].forEach((e=>{r.push(o.subscribe(e,(({source:e,measurement:t})=>{const{activeViewportId:r}=f.getState();if(n===r){const{referenceStudyUID:e,referenceSeriesUID:r,uid:s,toolName:i}=t;h("SET_DIRTY",{SeriesInstanceUID:r}),h("TRACK_SERIES",{viewportId:n,StudyInstanceUID:e,SeriesInstanceUID:r,measurementId:s,toolName:i})}})).unsubscribe)})),()=>{r.forEach((e=>{e()}))}}),[o,h,n,f]);const U=(0,r.useCallback)((e=>{const t=function(e,t,n,r){const{measurementService:s,viewportGridService:i}=t.services,o=s.getMeasurements(),{activeViewportId:a,viewports:l}=i.getState(),{displaySetInstanceUIDs:c}=l.get(a),{trackedSeries:u}=r.context,d=o.filter((e=>u.includes(e.referenceSeriesUID)&&c.includes(e.displaySetInstanceUID)));if(!d.length)return;const E=d.length,m=d.map((e=>e.uid));let p=m.findIndex((e=>e===n));-1===p?p=0:(p+=e,p<0?p=E-1:p===E&&(p=0));return m[p]}(e,s,T,b);t&&(y(t),o.jumpToMeasurement(n,t))}),[o,s,T,b,n]);(0,r.useEffect)((()=>{const e=function(e,t){if(!e)return null;return r.createElement(a.m_,null,r.createElement(a.k$,{asChild:!0},r.createElement("span",null,r.createElement(a.FI.StatusTracking,{className:"text-muted-foreground"}))),r.createElement(a.ZI,{align:"start",side:"bottom"},e?r.createElement(r.Fragment,null,t("Series is tracked and can be viewed in the measurement panel")):r.createElement(r.Fragment,null,t("Measurements for untracked series will not be shown in the measurements panel"))))}(D,I),t=p(D,U,n===g);v.addComponents([{viewportId:n,id:"viewportStatusComponent",component:e,indexPriority:-100,location:v.LOCATIONS.topLeft},{viewportId:n,id:"viewportActionArrowsComponent",component:t,indexPriority:0,location:v.LOCATIONS.topRight}])}),[g,D,U,v,n]);return r.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},(()=>{const{component:t}=i.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone");return r.createElement(t,E({},e,{onElementEnabled:t=>{e.onElementEnabled?.(t),N(t)},onElementDisabled:O}))})())}m.propTypes={displaySets:i().arrayOf(i().object.isRequired).isRequired,viewportId:i().string.isRequired,dataSource:i().object,children:i().node};const p=(e,t,n)=>e?r.createElement(o.$I,{onArrowsClick:e=>t(e),className:n?"visible":"invisible group-hover/pane:visible"}):null;const f=m}}]);
//# sourceMappingURL=9862.bundle.73ac489741f317531e11.js.map